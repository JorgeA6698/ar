<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>AR MundiAR 2026</title>

  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image.prod.js"></script>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image-aframe.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>

  <script>
    /* ----- SCRIPT 1: COMPONENTES DE AFRAME (EN HEAD) ----- */
    const animationMixers = new Map();
    
    AFRAME.registerComponent('change-flag-texture', {
      schema: { textureId: { type: 'string' } },
      init: function() {
        const self = this;
        let attempts = 0;
        const maxAttempts = 10;
        
        const tryChangeTexture = () => {
          const textureId = self.data.textureId;
          if (!textureId) return;
          
          const textureEl = document.querySelector(`#${textureId}`);
          if (!textureEl) return;
          
          const model = self.el.getObject3D('mesh');
          if (!model && attempts < maxAttempts) {
            attempts++;
            setTimeout(tryChangeTexture, 200);
            return;
          }
          if (!model) return;
          
          model.traverse((node) => {
            if (node.isMesh && node.material) {
              if (node.material.name === '01_-_Default' || 
                  (node.material.map && node.material.map.name && 
                   node.material.map.name.includes('Default_baseColor'))) {
                
                const texture = new THREE.Texture(textureEl);
                texture.needsUpdate = true;
                texture.wrapS = THREE.RepeatWrapping;
                texture.wrapT = THREE.RepeatWrapping;
                texture.anisotropy = 16;
                
                if (Array.isArray(node.material)) {
                  node.material = node.material.map(mat => mat.clone());
                  node.material.forEach(mat => {
                    if (mat.map) {
                      mat.map = texture;
                      mat.needsUpdate = true;
                    }
                  });
                } else {
                  node.material = node.material.clone();
                  node.material.map = texture;
                  node.material.needsUpdate = true;
                }
              }
            }
          });
        };
        
        this.el.addEventListener('model-loaded', tryChangeTexture);
        setTimeout(tryChangeTexture, 500);
      }
    });
    
    AFRAME.registerComponent('manual-animation', {
      init: function() {
        const el = this.el;
        const targetId = el.parentNode.getAttribute('id');
        
        let attempts = 0;
        const checkMixer = () => {
          const mixer = el.components['animation-mixer'];
          if (mixer && mixer.mixer) {
            mixer.mixer.timeScale = 0;
            animationMixers.set(targetId, mixer.mixer);
          } else if (attempts < 20) {
            attempts++;
            setTimeout(checkMixer, 200);
          }
        };
        
        el.addEventListener('model-loaded', () => setTimeout(checkMixer, 100));
      }
    });
  </script>

  <style>
    * {
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100vh;
      position: fixed;
      font-family: Arial, sans-serif;
    }

    /* La escena AR (lienzo) va al fondo a pantalla completa */
    #ar-scene {
      width: 100%;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1; /* La AR va de fondo */
    }

    /* --- CSS PARA EL LOGO Y MEN√ö --- */
    .logo {
      position: fixed;
      top: 20px;
      left: 20px;
      font-size: 6vw;
      font-weight: bold;
      color: white;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      z-index: 999999; 
      letter-spacing: 1px;
    }
    
    .menu-icon {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 999999; 
      cursor: pointer;
    }
    
    .menu-icon .bar {
      width: 35px;
      height: 4px;
      background-color: white;
      margin: 6px 0;
      transition: 0.4s;
      border-radius: 2px;
    }
    
    .side-nav {
      height: 100%;
      width: 0; 
      position: fixed;
      z-index: 999998; 
      top: 0;
      right: 0;
      background-color: rgba(0, 40, 104, 0.95);
      overflow-x: hidden;
      transition: 0.5s;
      padding-top: 60px;
      text-align: center;
    }
    
    .side-nav a {
      padding: 15px 25px;
      text-decoration: none;
      font-size: 6vw;
      color: #ccc;
      display: block;
      transition: 0.3s;
    }
    
    .side-nav a:hover,
    .side-nav a:active {
      color: #FFD700;
    }
    
    .side-nav a.active {
      color: white;
      font-weight: bold;
    }
    /* --- FIN DE CSS PARA EL LOGO Y MEN√ö --- */

    
    #home-button {
      position: fixed !important;
      bottom: 15px !important;
      left: 15px !important;
      width: 50px;
      height: 50px;
      background-color: rgba(255, 255, 255, 0.95);
      border: 2px solid #002868;
      border-radius: 50%;
      display: flex !important;
      align-items: center;
      justify-content: center;
      z-index: 999997; 
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: transform 0.1s ease;
      text-decoration: none;
      pointer-events: auto !important;
    }
    
    #home-button:active {
      transform: scale(0.85);
      background-color: #002868;
    }
    
    #home-button svg {
      width: 26px;
      height: 26px;
      fill: #002868;
    }
    
    #home-button:active svg {
      fill: white;
    }
    
    #button-container {
      position: fixed !important;
      bottom: 15px !important;
      right: 15px !important;
      z-index: 999997; 
      display: flex !important;
      flex-direction: column !important;
      gap: 10px;
      visibility: hidden;
    }
    
    .action-button {
      width: 55px;
      height: 55px;
      background-color: rgba(255, 255, 255, 0.95);
      border: 2px solid #002868;
      border-radius: 50%;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      font-size: 22px;
      color: #002868;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.1s ease;
      touch-action: manipulation;
    }

    .action-button:active {
      background-color: #002868;
      transform: scale(0.85);
      color: white;
    }

    #animate-button {
      background-color: rgba(0, 200, 0, 0.95);
      border-color: #006400;
      color: white;
    }

    #animate-button:active {
      background-color: #006400;
    }
    
    #debug-info {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.8);
      color: lime;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 11px;
      z-index: 999997;
      max-width: 200px;
      pointer-events: none;
    }
    
    /* === Estilos para los Modales (Trivia, Stats, Info, Video) === */
    #trivia-modal, #stats-modal, #info-modal, #video-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 1000000;
      display: none; /* Oculto por defecto */
      justify-content: center;
      align-items: center;
      padding: 10px;
      box-sizing: border-box;
    }
    
    .trivia-container, .stats-container, .info-container, .video-container {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      position: relative;
    }
    
    .trivia-close-btn, .stats-close-btn, .info-close-btn, .video-close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 28px;
      font-weight: bold;
      color: #888;
      cursor: pointer;
      line-height: 1;
    }
    .trivia-close-btn:hover, .stats-close-btn:hover, .info-close-btn:hover, .video-close-btn:hover {
      color: #000;
    }
    
    /* Estilos espec√≠ficos de Trivia */
    .trivia-question {
      margin-bottom: 20px;
      border-bottom: 1px solid #eee;
      padding-bottom: 15px;
    }
    .trivia-question h3 {
      font-size: 16px;
      margin: 0 0 10px 0;
      color: #333;
    }
    .trivia-options label {
      display: block;
      background-color: #f4f4f4;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    .trivia-options label:hover {
      background-color: #e9e9e9;
    }
    .trivia-options input {
      margin-right: 10px;
    }
    
    #trivia-submit {
      width: 100%;
      padding: 12px;
      background-color: #002868;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    #trivia-submit:hover {
      background-color: #001a4a;
    }
    
    #trivia-results {
      margin-top: 20px;
    }
    .trivia-result-item {
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 10px;
      font-size: 14px;
      border: 1px solid;
    }
    .trivia-result-item.correct {
      background-color: #dff0d8;
      border-color: #d6e9c6;
      color: #3c763d;
    }
    .trivia-result-item.incorrect {
      background-color: #f2dede;
      border-color: #ebccd1;
      color: #a94442;
    }

    /* Estilos espec√≠ficos de Stats e Info */
    #stats-content h3, #info-content h3, #video-content h3 {
       margin-top: 0;
       color: #002868; /* Color del tema */
       border-bottom: 2px solid #eee;
       padding-bottom: 10px;
    }
    
    #stats-content ul, #info-content ul {
      list-style-type: none;
      padding-left: 0;
    }
    
    #stats-content li, #info-content li {
      background-color: #f4f4f4;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 5px;
      font-size: 14px;
    }
    
    #stats-content li strong, #info-content li strong {
      color: #333;
    }

    /* === ESTILOS PARA VIDEO (NUEVO) === */
    #modal-video-player {
      width: 100%;
      border-radius: 5px;
      background-color: #000;
    }
    /* Clase de filtro B/N */
    .bw-filter {
      filter: grayscale(100%);
    }
    
    #bw-filter-button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
    }
    #bw-filter-button:active {
      background-color: #555;
    }

  </style>
</head>
<body>

  <div class="logo">MundiAR</div>
  <div class="menu-icon" onclick="toggleNav()">
    <div class="bar"></div>
    <div class="bar"></div>
    <div class="bar"></div>
  </div>
  <div id="mySidenav" class="side-nav">
    <a href="index.html">Inicio</a>
    <a href="video.html">Video</a>
    <a href="trivia.html">Trivia</a>
    <a href="PruebaAr.html" class="active">AR</a>
  </div>
  
  <div id="debug-info">
    <div>Status: <span id="d-status">Cargando...</span></div>
    <div>Targets: <span id="d-targets">0</span></div>
    <div>Botones: <span id="d-buttons">ocultos</span></div>
  </div>

  <a href="index.html" id="home-button">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
    </svg>
  </a>

  <div id="button-container">
    <button class="action-button" id="animate-button">‚ñ∂Ô∏è</button>
    <button class="action-button" id="estadisticas">üìä</button>
    <button class="action-button" id="info">‚ÑπÔ∏è</button> 
    <button class="action-button" id="video-button">üé•</button> <button class="action-button" id="Trivia">‚ùî</button>
  </div>
  
  <div id="trivia-modal">
    <div class="trivia-container">
      <span class="trivia-close-btn" id="trivia-close">&times;</span>
      <h2>Trivia del Mundial</h2>
      <div id="trivia-content"></div>
      <div id="trivia-results"></div>
      <button id="trivia-submit">Enviar</button>
    </div>
  </div>

  <div id="stats-modal">
    <div class="stats-container">
      <span class="stats-close-btn" id="stats-close">&times;</span>
      <h2>Estad√≠sticas del Pa√≠s</h2>
      <div id="stats-content"></div>
    </div>
  </div>

  <div id="info-modal">
    <div class="info-container">
      <span class="info-close-btn" id="info-close">&times;</span>
      <h2>Datos Curiosos</h2>
      <div id="info-content"></div>
    </div>
  </div>

  <div id="video-modal">
    <div class="video-container">
      <span class="video-close-btn" id="video-close">&times;</span>
      <div id="video-content">
        <h3 id="video-title">Video del Pa√≠s</h3>
        <video id="modal-video-player" controls playsinline></video>
        <button id="bw-filter-button">Filtro B/N</button>
      </div>
    </div>
  </div>

  <a-scene
    id="ar-scene"
    mindar-image="imageTargetSrc: ./targets.mind; maxTrack: 1; filterMinCF: 0.0001; filterBeta: 0.001; uiLoading: no"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
    embedded
    renderer="colorManagement: true; physicallyCorrectLights: true;"
  >
    <a-assets>
      <a-asset-item id="flag-model" src="./mexico_flag/scene.gltf"></a-asset-item>
      <img id="mexico-texture" crossorigin="anonymous" src="./mexico_flag/textures/01_-_Default_baseColor.png">
      <img id="canada-texture" crossorigin="anonymous" src="./textures/canada_baseColor.png">
      <img id="usa-texture" crossorigin="anonymous" src="./textures/usa_basecolor.png">
      <img id="argentina-texture" crossorigin="anonymous" src="./textures/argentina_basecolor.jpg">
      <img id="brasil-texture" crossorigin="anonymous" src="./textures/brasil_basecolor.jpg">
      <img id="colombia-texture" crossorigin="anonymous" src="./textures/colombia_basecolor.jpg">
      <img id="paraguay-texture" crossorigin="anonymous" src="./textures/paraguay_basecolor.jpg">
      <img id="ecuador-texture" crossorigin="anonymous" src="./textures/ecuador_basecolor.jpg">
      <img id="uruguay-texture" crossorigin="anonymous" src="./textures/uruguay_basecolor.jpg">
      <img id="marruecos-texture" crossorigin="anonymous" src="./textures/marruecos_basecolor.jpg">
      <img id="tunez-texture" crossorigin="anonymous" src="./textures/tunez_basecolor.jpg">
      <img id="australia-texture" crossorigin="anonymous" src="./textures/australia_basecolor.jpg">
      <img id="iran-texture" crossorigin="anonymous" src="./textures/iran_basecolor.png">
      <img id="japon-texture" crossorigin="anonymous" src="./textures/japon_basecolor.png">
      <img id="jordania-texture" crossorigin="anonymous" src="./textures/jordania_basecolor.png">
      <img id="coreadelsur-texture" crossorigin="anonymous" src="./textures/coreadelsur_basecolor.jpg">
      <img id="uzbekistan-texture" crossorigin="anonymous" src="./textures/Uzbekistan_basecolor.png">
      <img id="nuevazelanda-texture" crossorigin="anonymous" src="./textures/nuevazelanda_basecolor.png">
    </a-assets>
    <a-camera position="0 0 0" look-controls="enabled: false" fov="65"></a-camera>
  </a-scene>

 <script>
    /* ----- SCRIPT 2: L√ìGICA DE LA APLICACI√ìN (UNIFICADA) ----- */

    // --- Funciones de Ayuda (Globales) ---
    const $ = (id) => document.getElementById(id);
    const debug = (key, val) => {
      const el = $(`d-${key}`);
      if (el) el.textContent = val;
    };

    /* === BASE DE DATOS DE ESTAD√çSTICAS === */
    const statsData = {
      'argentina-texture': { pais: 'Argentina', mundiales: '18', primeraVez: '1930', goles: '137', jugadores: 'Lionel Messi, Diego Maradona, Gabriel Batistuta' },
      'australia-texture': { pais: 'Australia', mundiales: '6', primeraVez: '1974', goles: '17', jugadores: 'Tim Cahill, Mark Viduka, Harry Kewell' },
      'brasil-texture': { pais: 'Brasil', mundiales: '22', primeraVez: '1930', goles: '237', jugadores: 'Pel√©, Ronaldo Naz√°rio, Garrincha, Neymar' },
      'canada-texture': { pais: 'Canad√°', mundiales: '2', primeraVez: '1986', goles: '2', jugadores: 'Alphonso Davies, Jonathan David, Cyle Larin, Atiba Hutchinson' },
      'colombia-texture': { pais: 'Colombia', mundiales: '6', primeraVez: '1962', goles: '20', jugadores: 'James Rodr√≠guez, Carlos Valderrama, Radamel Falcao' },
      'coreadelsur-texture': { pais: 'Corea del Sur', mundiales: '11', primeraVez: '1954', goles: '36', jugadores: 'Son Heung-min, Park Ji-Sung, Cha Bum-Kun' },
      'ecuador-texture': { pais: 'Ecuador', mundiales: '4', primeraVez: '2002', goles: '12', jugadores: 'Enner Valencia, Antonio Valencia, Alberto Spencer' },
      'usa-texture': { pais: 'Estados Unidos', mundiales: '11', primeraVez: '1930', goles: '45', jugadores: 'Landon Donovan, Clint Dempsey, Christian Pulisic' },
      'iran-texture': { pais: 'Ir√°n', mundiales: '6', primeraVez: '1978', goles: '9', jugadores: 'Ali Daei, Mehdi Taremi, Sardar Azmoun' },
      'japon-texture': { pais: 'Jap√≥n', mundiales: '7', primeraVez: '1998', goles: '23', jugadores: 'Hidetoshi Nakata, Shunsuke Nakamura, Keisuke Honda, Kunishige Kamamoto' },
      'jordania-texture': { pais: 'Jordania', mundiales: '0', primeraVez: '2026', goles: '0', jugadores: 'Musa Al-Taamari, Hamza Al-Daradour' },
      'marruecos-texture': { pais: 'Marruecos', mundiales: '6', primeraVez: '1970', goles: '17', jugadores: 'Achraf Hakimi, Hakim Ziyech, Yassine Bounou, Mustapha Hadji' },
      'mexico-texture': { pais: 'M√©xico', mundiales: '17', primeraVez: '1930', goles: '60', jugadores: 'Hugo S√°nchez, Cuauht√©moc Blanco, Antonio Carbajal, Javier Hern√°ndez' },
      'nuevazelanda-texture': { pais: 'Nueva Zelanda', mundiales: '2', primeraVez: '1982', goles: '4', jugadores: 'Wynton Rufer, Ryan Nelsen, Chris Wood' },
      'paraguay-texture': { pais: 'Paraguay', mundiales: '8', primeraVez: '1930', goles: '27', jugadores: 'Jos√© Luis Chilavert, Roque Santa Cruz, Jos√© Saturnino Cardozo' },
      'tunez-texture': { pais: 'T√∫nez', mundiales: '6', primeraVez: '1978', goles: '13', jugadores: 'Wahbi Khazri, Tarak Dhiab, Radhi Ja√Ødi' },
      'uruguay-texture': { pais: 'Uruguay', mundiales: '14', primeraVez: '1930', goles: '88', jugadores: 'Luis Su√°rez, Edinson Cavani, Diego Forl√°n, Juan Alberto Schiaffino' },
      'uzbekistan-texture': { pais: 'Uzbekist√°n', mundiales: '0', primeraVez: '2026', goles: '0', jugadores: 'Eldor Shomurodov, Server Djeparov' }
    };

    /* === BASE DE DATOS DE INFO (ACTUALIZADA) === */
    const infoData = {
      'argentina-texture': { pais: 'Argentina', comida: 'Asado', fundacion: '1816', capital: 'Buenos Aires', poblacion: '46.04 millones' },
      'australia-texture': { pais: 'Australia', comida: 'Meat Pie', fundacion: '1901', capital: 'Canberra', poblacion: '27.1 millones' },
      'brasil-texture': { pais: 'Brasil', comida: 'Feijoada', fundacion: '1822', capital: 'Brasilia', poblacion: '203.06 millones' },
      'canada-texture': { pais: 'Canad√°', comida: 'Poutine', fundacion: '1867', capital: 'Ottawa', poblacion: '38.5 millones' },
      'colombia-texture': { pais: 'Colombia', comida: 'Bandeja Paisa', fundacion: '1810', capital: 'Bogot√°', poblacion: '52.08 millones' },
      'coreadelsur-texture': { pais: 'Corea del Sur', comida: 'Kimchi', fundacion: '1948', capital: 'Se√∫l', poblacion: '51.7 millones' },
      'ecuador-texture': { pais: 'Ecuador', comida: 'Ceviche', fundacion: '1820', capital: 'Quito', poblacion: '18.19 millones' },
      'usa-texture': { pais: 'Estados Unidos', comida: 'Hamburguesa/Apple Pie', fundacion: '1776', capital: 'Washington D.C.', poblacion: '330.66 millones' },
      'iran-texture': { pais: 'Ir√°n', comida: 'Chelo Kabab', fundacion: '1979', capital: 'Teher√°n', poblacion: '89.1 millones' },
      'japon-texture': { pais: 'Jap√≥n', comida: 'Sushi/Ramen', fundacion: '1868', capital: 'Tokio', poblacion: '125.1 millones' },
      'jordania-texture': { pais: 'Jordania', comida: 'Mansaf', fundacion: '1946', capital: 'Am√°n', poblacion: '11.3 millones' },
      'marruecos-texture': { pais: 'Marruecos', comida: 'Tajine', fundacion: '1956', capital: 'Rabat', poblacion: '38.0 millones' },
      'mexico-texture': { pais: 'M√©xico', comida: 'Mole', fundacion: '1810', capital: 'Ciudad de M√©xico', poblacion: '130.26 millones' },
      'nuevazelanda-texture': { pais: 'Nueva Zelanda', comida: 'HƒÅngi', fundacion: '1907', capital: 'Wellington', poblacion: '5.3 millones' },
      'paraguay-texture': { pais: 'Paraguay', comida: 'Sopa Paraguaya', fundacion: '1811', capital: 'Asunci√≥n', poblacion: '7.45 millones' },
      'tunez-texture': { pais: 'T√∫nez', comida: 'Cusc√∫s', fundacion: '1956', capital: 'T√∫nez', poblacion: '12.3 millones' },
      'uruguay-texture': { pais: 'Uruguay', comida: 'Chivito', fundacion: '1828', capital: 'Montevideo', poblacion: '3.48 millones' },
      'uzbekistan-texture': { pais: 'Uzbekist√°n', comida: 'Plov', fundacion: '1991', capital: 'Tashkent', poblacion: '35.6 millones' }
    };

    /* === BASE DE DATOS DE VIDEO === */
    const videoData = {
      'argentina-texture': { videoFile: 'argentina.mp4', nombre: 'Argentina' },
      'australia-texture': { videoFile: 'australia.mp4', nombre: 'Australia' },
      'brasil-texture': { videoFile: 'brasil.mp4', nombre: 'Brasil' },
      'canada-texture': { videoFile: 'canada.mp4', nombre: 'Canad√°' },
      'colombia-texture': { videoFile: 'colombia.mp4', nombre: 'Colombia' },
      'coreadelsur-texture': { videoFile: 'coreadelsur.mp4', nombre: 'Corea del Sur' },
      'ecuador-texture': { videoFile: 'ecuador.mp4', nombre: 'Ecuador' },
      'usa-texture': { videoFile: 'EUA.mp4', nombre: 'Estados Unidos' }, // Nombre de archivo como especificaste
      'iran-texture': { videoFile: 'iran.mp4', nombre: 'Ir√°n' },
      'japon-texture': { videoFile: 'japon.mp4', nombre: 'Jap√≥n' },
      'jordania-texture': { videoFile: 'jordania.mp4', nombre: 'Jordania' },
      'marruecos-texture': { videoFile: 'marruecos.mp4', nombre: 'Marruecos' }, // Nombre de archivo como especificaste
      'mexico-texture': { videoFile: 'mexico.mp4', nombre: 'M√©xico' },
      'nuevazelanda-texture': { videoFile: 'nuevazelanda.mp4', nombre: 'Nueva Zelanda' },
      'paraguay-texture': { videoFile: 'paraguay.mp4', nombre: 'Paraguay' },
      'tunez-texture': { videoFile: 'tunez.mp4', nombre: 'T√∫nez' },
      'uruguay-texture': { videoFile: 'uruguay.mp4', nombre: 'Uruguay' },
      'uzbekistan-texture': { videoFile: 'uzbekistan.mp4', nombre: 'Uzbekist√°n' }
    };


    /* === L√ìGICA DE TRIVIA (Global) === */
    const triviaQuestions = [ { q: "¬øEn qu√© a√±o particip√≥ Canad√° por primera vez en una Copa del Mundo masculina?", a: "1986", options: ["1986", "1994", "1978"] }, { q: "¬øCu√°l es la mejor posici√≥n hist√≥rica de EE.UU. en una Copa del Mundo?", a: "Tercer lugar (en 1930)", options: ["Tercer lugar (en 1930)", "Cuartos de final (en 2002)", "Octavos de final (en 1994)"] }, { q: "¬øCu√°ntas veces M√©xico ha sido sede de la Copa del Mundo (contando 2026)?", a: "Tres veces", options: ["Tres veces", "Dos veces", "Una vez"] }, { q: "¬øQui√©n es el m√°ximo goleador hist√≥rico de Argentina en Mundiales?", a: "Lionel Messi", options: ["Lionel Messi", "Gabriel Batistuta", "Diego Maradona"] }, { q: "¬øQu√© pa√≠s, adem√°s de Brasil, ha jugado todas las ediciones del Mundial?", a: "Ninguno (Brasil es el √∫nico)", options: ["Ninguno (Brasil es el √∫nico)", "Alemania", "Italia", "Argentina"] }, { q: "¬øCu√°l fue el rival de Ecuador en su partido inaugural en Qatar 2022?", a: "Qatar", options: ["Qatar", "Senegal", "Pa√≠ses Bajos"] }, { q: "¬øQu√© pa√≠s fue el primer campe√≥n mundial en 1930?", a: "Uruguay", options: ["Uruguay", "Argentina", "Italia"] }, { q: "¬øQu√© jugador colombiano gan√≥ el Bot√≠n de Oro en el Mundial de 2014?", a: "James Rodr√≠guez", options: ["James Rodr√≠guez", "Radamel Falcao", "Thomas M√ºller"] }, { q: "¬øCu√°l ha sido la mejor actuaci√≥n hist√≥rica de Paraguay en un Mundial?", a: "Cuartos de final (2010)", options: ["Cuartos de final (2010)", "Octavos de final", "Fase de grupos"] }, { q: "¬øC√≥mo se le conoce popularmente a la selecci√≥n de Jap√≥n?", a: "Samurai Blue", options: ["Samurai Blue", "Los Dragones Azules", "Guerreros del Sol"] }, { q: "¬øEn qu√© Mundial logr√≥ Ir√°n su primera victoria en la historia del torneo?", a: "Mundial de 1998", options: ["Mundial de 1998", "Mundial de 1978", "Mundial de 2006"] }, { q: "¬øJunto a qu√© pa√≠s organiz√≥ Corea del Sur el Mundial de 2002?", a: "Jap√≥n", options: ["Jap√≥n", "China", "Tailandia"] }, { q: "¬øQu√© hito logr√≥ Jordania al clasificar para 2026?", a: "Clasificar por primera vez a un Mundial", options: ["Clasificar por primera vez a un Mundial", "Ganar la Copa Asi√°tica", "Ser anfitri√≥n"] }, { q: "¬øQu√© hito logr√≥ Uzbekist√°n al clasificar para 2026?", a: "Clasificar por primera vez a un Mundial", options: ["Clasificar por primera vez a un Mundial", "Ganar la Copa Asi√°tica", "Llegar a semifinales"] }, { q: "¬øA qu√© confederaci√≥n futbol√≠stica pertenece Australia desde 2006?", a: "Asi√°tica (AFC)", options: ["Asi√°tica (AFC)", "Ocean√≠a (OFC)", "UEFA (Europa)"] }, { q: "¬øCu√°l es el apodo de la selecci√≥n de Nueva Zelanda?", a: "All Whites", options: ["All Whites", "All Blacks", "Los Kiwis"] }, { q: "¬øQu√© selecci√≥n africana fue la primera en llegar a semifinales (en 2022)?", a: "Marruecos", options: ["Marruecos", "Senegal", "Camer√∫n", "Ghana"] }, { q: "¬øEn qu√© Mundial, T√∫nez se convirti√≥ en el primer equipo africano en ganar un partido?", a: "Mundial de 1978", options: ["Mundial de 1978", "Mundial de 1982", "Mundial de 1990"] } ];
    function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }
    let currentQuestions = [];
    function showTrivia() { $('trivia-content').innerHTML = ''; $('trivia-results').innerHTML = ''; $('trivia-submit').style.display = 'block'; currentQuestions = shuffleArray([...triviaQuestions]).slice(0, 5); currentQuestions.forEach((item, index) => { const questionId = `q${index}`; const shuffledOptions = shuffleArray([...item.options]); const optionsHtml = shuffledOptions.map(option => ` <label> <input type="radio" name="${questionId}" value="${option}"> ${option} </label> `).join(''); const questionHtml = ` <div class="trivia-question" data-correct-answer="${item.a}"> <h3>${index + 1}. ${item.q}</h3> <div class="trivia-options"> ${optionsHtml} </div> </div> `; $('trivia-content').innerHTML += questionHtml; }); $('trivia-modal').style.display = 'flex'; }
    function hideTrivia() { $('trivia-modal').style.display = 'none'; }
    function checkTriviaAnswers() { $('trivia-submit').style.display = 'none'; $('trivia-results').innerHTML = ''; const questionElements = document.querySelectorAll('.trivia-question'); let correctCount = 0; questionElements.forEach((qEl, index) => { const selectedInput = qEl.querySelector('input[type="radio"]:checked'); const correctAnswer = qEl.getAttribute('data-correct-answer'); const questionText = currentQuestions[index].q; let resultHtml = ''; if (selectedInput && selectedInput.value === correctAnswer) { correctCount++; resultHtml = ` <div class="trivia-result-item correct"> <b>Pregunta ${index + 1}: ¬°Correcto!</b><br> ${questionText} </div> `; } else { resultHtml = ` <div class="trivia-result-item incorrect"> <b>Pregunta ${index + 1}: Incorrecto.</b><br> <i>Respuesta correcta: ${correctAnswer}</i> </div> `; } $('trivia-results').innerHTML += resultHtml; }); $('trivia-results').innerHTML = `<h3>Acertaste ${correctCount} de 5</h3>` + $('trivia-results').innerHTML; }
    
    /* === L√ìGICA DE ESTAD√çSTICAS (Global) === */
    function showStats() {
      if (!currentVisibleTarget) return; 
      const targetIndex = parseInt(currentVisibleTarget.split('-')[1]);
      const textureId = getTextureIdForIndex(targetIndex); 
      if (!textureId) return;
      const data = statsData[textureId];
      if (!data) {
         debug('status', 'Error: No hay datos de stats para ' + textureId);
         return;
      }
      const statsHtml = `
        <h3>${data.pais}</h3>
        <ul>
          <li><strong>Mundiales:</strong> ${data.mundiales}</li>
          <li><strong>Primera vez:</strong> ${data.primeraVez}</li>
          <li><strong>Goles totales:</strong> ${data.goles}</li>
          <li><strong>Mejores jugadores:</strong> ${data.jugadores}</li>
        </ul>
      `;
      $('stats-content').innerHTML = statsHtml;
      $('stats-modal').style.display = 'flex';
    }
    function hideStats() {
      $('stats-modal').style.display = 'none';
    }

    /* === L√ìGICA DE INFO (Global - ACTUALIZADA) === */
    function showInfo() {
      if (!currentVisibleTarget) return; 
      const targetIndex = parseInt(currentVisibleTarget.split('-')[1]);
      const textureId = getTextureIdForIndex(targetIndex); 
      if (!textureId) return;
      
      const data = infoData[textureId]; 
      if (!data) {
         debug('status', 'Error: No hay datos de info para ' + textureId);
         return;
      }
      const infoHtml = `
        <h3>${data.pais}</h3>
        <ul>
          <li><strong>Comida T√≠pica:</strong> ${data.comida}</li>
          <li><strong>Fundaci√≥n (Estado Moderno):</strong> ${data.fundacion}</li>
          <li><strong>Capital:</strong> ${data.capital}</li>
          <li><strong>Poblaci√≥n Aprox:</strong> ${data.poblacion}</li>
        </ul>
      `;
      
      $('info-content').innerHTML = infoHtml; 
      $('info-modal').style.display = 'flex'; 
    }
    function hideInfo() {
      $('info-modal').style.display = 'none';
    }
    
    /* === L√ìGICA DE VIDEO (Global - CORREGIDO) === */
    function showVideo() {
      if (!currentVisibleTarget) return; 
      const targetIndex = parseInt(currentVisibleTarget.split('-')[1]);
      const textureId = getTextureIdForIndex(targetIndex); 
      if (!textureId) return;

      const data = videoData[textureId]; 
      if (!data) {
         debug('status', 'Error: No hay video para ' + textureId);
         return;
      }

      const player = $('modal-video-player');
      const videoTitle = $('video-title');
      
      videoTitle.textContent = "Video: " + data.nombre; // Pone el t√≠tulo
      
      // ----- ¬°CAMBIO AQU√ç! Se a√±ade la carpeta "videos/" -----
      player.src = "videos/" + data.videoFile; 
      
      player.classList.remove('bw-filter'); // Resetea el filtro
      
      $('video-modal').style.display = 'flex'; 
      player.play(); // Reproduce el video
    }
    
    function hideVideo() {
      const player = $('modal-video-player');
      player.pause(); // Pausa el video
      player.src = ""; // Detiene la carga
      $('video-modal').style.display = 'none';
    }
    /* === FIN DE L√ìGICA DE VIDEO === */


    /* === L√ìGICA GLOBAL (para que showStats y showInfo funcionen) === */
    const targetMap = [
        { start: 0, end: 3, textureId: 'mexico-texture' },       
        { start: 4, end: 6, textureId: 'canada-texture' },       
        { start: 7, end: 9, textureId: 'usa-texture' },          
        { start: 10, end: 12, textureId: 'argentina-texture' },  
        { start: 13, end: 16, textureId: 'brasil-texture' },     
        { start: 17, end: 21, textureId: 'colombia-texture' },   
        { start: 22, end: 25, textureId: 'paraguay-texture' },   
        { start: 26, end: 28, textureId: 'ecuador-texture' },    
        { start: 29, end: 33, textureId: 'uruguay-texture' },    
        { start: 34, end: 36, textureId: 'marruecos-texture' },  
        { start: 37, end: 39, textureId: 'tunez-texture' },      
        { start: 40, end: 42, textureId: 'australia-texture' },  
        { start: 43, end: 45, textureId: 'iran-texture' },       
        { start: 46, end: 49, textureId: 'japon-texture' },      
        { start: 50, end: 53, textureId: 'jordania-texture' },   
        { start: 54, end: 56, textureId: 'coreadelsur-texture' },
        { start: 57, end: 59, textureId: 'uzbekistan-texture' }, 
        { start: 60, end: 63, textureId: 'nuevazelanda-texture' } 
    ];

    const getTextureIdForIndex = (index) => {
      for (const map of targetMap) {
        if (index >= map.start && index <= map.end) return map.textureId;
      }
      return null;
    };
    
    let currentVisibleTarget = null;
    /* === FIN DE L√ìGICA GLOBAL === */


    /* === INICIO DE L√ìGICA DE AR (Listeners) === */
    document.addEventListener('DOMContentLoaded', () => {
      
      const sceneEl = $('ar-scene');
      const buttonContainer = $('button-container');
      debug('status', 'Inicializado');

      const allTargets = [];
      for (let i = 0; i <= 63; i++) {
        const textureId = getTextureIdForIndex(i); 
        if (!textureId) continue;

        const targetEntity = document.createElement('a-entity');
        targetEntity.setAttribute('mindar-image-target', `targetIndex: ${i}`);
        targetEntity.setAttribute('id', `target-${i}`);
        
        const flagModel = document.createElement('a-entity');
        flagModel.setAttribute('gltf-model', '#flag-model');
        flagModel.setAttribute('animation-mixer', '');
        flagModel.setAttribute('manual-animation', '');
        flagModel.setAttribute('scale', '0.0005 0.0005 0.0005');
        flagModel.setAttribute('position', '0 0 0');
        flagModel.setAttribute('change-flag-texture', `textureId: ${textureId}`);

        targetEntity.appendChild(flagModel);
        sceneEl.appendChild(targetEntity);
        allTargets.push({entity: targetEntity, index: i, id: `target-${i}`});
      }

      let isAnimating = false;
      
      allTargets.forEach((target) => {
        target.entity.addEventListener('targetFound', () => {
          currentVisibleTarget = target.id; 
          debug('status', `Target ${target.index} ENCONTRADO`);
          debug('targets', '1');
          debug('buttons', 'VISIBLES');
          
          buttonContainer.style.visibility = 'visible'; 
          isAnimating = false; 
          $('animate-button').textContent = '‚ñ∂Ô∏è';
        });

        target.entity.addEventListener('targetLost', () => {
          if (currentVisibleTarget === target.id) {
            currentVisibleTarget = null; 
            debug('status', 'Sin target');
            debug('targets', '0');
            debug('buttons', 'ocultos');
            buttonContainer.style.visibility = 'hidden'; 
            isAnimating = false;
          }
        });
      });

      $('animate-button').addEventListener('click', () => {
        if (!currentVisibleTarget) return; 
        
        const mixer = animationMixers.get(currentVisibleTarget);
        if (mixer) {
          if (!isAnimating) {
            mixer.timeScale = 1; 
            isAnimating = true;
            $('animate-button').textContent = '‚è∏Ô∏è';
            debug('status', 'ANIMANDO');
          } else {
            mixer.timeScale = 0; 
            isAnimating = false;
            $('animate-button').textContent = '‚ñ∂Ô∏è';
            debug('status', 'PAUSADO');
          }
        } else {
          debug('status', 'Error: Mixer no encontrado');
        }
      });

      // --- Conexi√≥n de todos los botones ---
      $('estadisticas').addEventListener('click', showStats);
      $('Trivia').addEventListener('click', showTrivia);
      $('info').addEventListener('click', showInfo); 
      $('video-button').addEventListener('click', showVideo); // BOT√ìN NUEVO
      
      // --- Cierres de todos los modales ---
      $('trivia-close').addEventListener('click', hideTrivia);
      $('trivia-submit').addEventListener('click', checkTriviaAnswers);
      $('stats-close').addEventListener('click', hideStats);
      $('info-close').addEventListener('click', hideInfo); 
      $('video-close').addEventListener('click', hideVideo); // BOT√ìN NUEVO

      // --- L√≥gica del filtro B/N (NUEVO) ---
      $('bw-filter-button').addEventListener('click', () => {
        const player = $('modal-video-player');
        player.classList.toggle('bw-filter');
      });

    }); // <-- Llave de cierre para 'DOMContentLoaded'
    
    /* === FIN DE L√ìGICA DE AR === */

    // JAVASCRIPT PARA EL MEN√ö (Global)
    function toggleNav() {
      var nav = document.getElementById("mySidenav");
      if (nav.style.width === "250px") {
        nav.style.width = "0";
      } else {
        nav.style.width = "250px";
      }
    }
  </script>
</body>
</html>